#!/bin/bash

WINDOW="dci"
DCI_DIR="/home/max/Documents/dev/python/dci"

attach () {
  tmux select-window -t "$WINDOW"
  exit 0
}

create () {
  # create panes and launch
  tmux new-window -d -n "$WINDOW" -c "$DCI_DIR"
  tmux split-window -d -t "$WINDOW" -h -c "$DCI_DIR"
  tmux split-window -d -t "$WINDOW" -v -c "$DCI_DIR"
  tmux split-window -d -t "$WINDOW" -v -c "$DCI_DIR"
  tmux split-window -d -t "$WINDOW.2" -v -c "$DCI_DIR"

  # source virtualenv for the small one
  for i in $(seq 0 3)
  do
    tmux send-keys -t "$WINDOW.$i" 'source .v/bin/activate' Enter
    tmux send-keys -t "$WINDOW.$i" C-l
  done
}

# if $WINDOW already exist attach to it and exit
if [ ! -z "$(tmux list-windows | awk -v p="^$WINDOW-?$" '$2 ~ p {print $1}')" ]
then
  attach
fi

# otherwise create it then attach
create
attach
